<!-- src/app/app.component.html -->
<div class="app-container">
  <!-- Header Section -->
  <header class="app-header" *ngIf="isAuthenticated">
    <h1>{{ title }}</h1>
    <nav class="navbar">
      <ul>
        <li><a href="#" (click)="navigateTo('home')">Home</a></li>
        <li><a href="#" (click)="navigateTo('chat')">Chat</a></li>
        <li><a href="#" (click)="navigateTo('group-management')">Group Management</a></li>
        <li><a href="#" (click)="navigateTo('user-management')">User Management</a></li>
        <li><a href="#" (click)="navigateTo('video-chat')">Video Chat</a></li>
        <li><a href="#" (click)="logout()">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Main Content Section -->
  <main class="main-content">
    <!-- Login Section -->
<section *ngIf="!isAuthenticated" class="login-section">
  <div class="login-container">
    <div class="login-form">
      <h2>Login</h2>
      <form (submit)="login()">
        <div>
          <label for="username">Username:</label>
          <input type="text" id="username" [(ngModel)]="username" name="username" required>
        </div>
        <div>
          <label for="password">Password:</label>
          <input type="password" id="password" [(ngModel)]="password" name="password" required>
        </div>
        <button type="submit">Login</button>
        <p *ngIf="loginError" class="error">{{ loginError }}</p>
        <p>Don't have an account? <button (click)="register()">Register</button></p>
      </form>
    </div>
  </div>
</section>

    <!-- Home Section -->
    <section *ngIf="isAuthenticated && currentSection === 'home'" class="home-section">
      <h2>Welcome to the Home Page</h2>
      <p>Use the navigation above to access different features of the application.</p>
      
      <!-- Chat User Specific Content -->
      <div *ngIf="userRole === 'chatUser'">
        <h3>Available Groups</h3>
        <ul>
          <li *ngFor="let group of groups">
            {{ group.name }}
            <button (click)="joinGroupRequest(group.name)" *ngIf="!chatUser?.groups?.includes(group.name)">Request to Join</button>
            <button (click)="leaveGroup(group.name)" *ngIf="chatUser?.groups?.includes(group.name)">Leave Group</button>
            <ul *ngFor="let channel of group.channels">
              <li>
                {{ channel.name }}
                <button (click)="joinChannel(group.name, channel.name)" *ngIf="!channel.members.includes(chatUser?.username || '')">Join Channel</button>
                <button (click)="leaveChannel(group.name, channel.name)" *ngIf="channel.members.includes(chatUser?.username || '')">Leave Channel</button>
              </li>
            </ul>
          </li>
        </ul>
        <h3>Your Groups</h3>
        <ul *ngIf="chatUser && chatUser.groups && chatUser.groups.length > 0">
          <li *ngFor="let group of chatUser.groups">{{ group }}</li>
        </ul>
      </div>

      <!-- Admin view to manage group requests -->
      <div *ngIf="userRole === 'superAdmin' || userRole === 'groupAdmin'">
        <h3>Manage Group Requests</h3>
        <ul *ngFor="let group of groups">
          <li *ngFor="let request of group.requests">
            {{ request }} requested to join {{ group.name }}
            <button (click)="approveRequest(group.name, request)">Approve</button>
            <button (click)="denyRequest(group.name, request)">Deny</button>
          </li>
        </ul>
      </div>
    </section>
    
    <!-- Chat Section -->
<section *ngIf="isAuthenticated && currentSection === 'chat'" class="chat-section">
  <h2>Chat Window</h2>
  <div *ngIf="userRole === 'chatUser'">
    <h3>Your Channels</h3>
    <ul *ngIf="chatUser && chatUser.groups && chatUser.groups.length > 0">
      <li *ngFor="let group of chatUser.groups">
        <div *ngFor="let channel of getChannels(group)">
          <div class="channel-chat">
            <h4>{{ channel.name }}</h4>
            <div class="messages" *ngIf="channelMessages[channel.name]">
              <div *ngFor="let message of channelMessages[channel.name]">
                <p>{{ message.username }}: {{ message.text }}</p>
              </div>
            </div>
            <input type="text" [(ngModel)]="newMessage[channel.name]" placeholder="Type your message..." />
            <button (click)="sendMessage(group, channel.name)">Send</button>
          </div>
        </div>
      </li>
    </ul>
    <button (click)="deleteAccount()">Delete Account</button>
  </div>
</section>

    <!-- Group Management Section -->
    <section *ngIf="isAuthenticated && currentSection === 'group-management'" class="group-management-section">
      <h2>Group Management</h2>
      
      <!-- Display for Group Admin and Super Admin -->
      <div *ngIf="userRole === 'superAdmin' || userRole === 'groupAdmin'">
        <button (click)="createGroup()">Create Group</button>

        <!-- Display Created Groups -->
        <div *ngIf="groups.length > 0" class="groups-list">
          <h3>Groups:</h3>
          <ul>
            <li *ngFor="let group of groups">
              {{ group.name }}
              <button (click)="createChannel(group.name)">Create Channel</button>
              <button (click)="removeGroup(group.name)">Remove Group</button>
              <!-- Members of Group -->
              <div>
                <strong>Members of Group:</strong>
                <ul>
                  <li *ngFor="let member of group.members">
                    {{ member }}
                    <button (click)="removeMember(group.name, member)">Remove</button>
                  </li>
                </ul>
              </div>
              <!-- Channels and Members -->
              <div *ngFor="let channel of group.channels">
                <strong>Members of Channel: {{ channel.name }}:</strong>
                <ul>
                  <li *ngFor="let member of channel.members">
                    {{ member }}
                    <button (click)="removeMember(group.name, member)">Remove</button>
                  </li>
                </ul>
                <button (click)="removeChannel(group.name, channel.name)">Remove Channel</button>
              </div>
              <!-- Manage Requests -->
              <div>
                <strong>Requests:</strong>
                <ul>
                  <li *ngFor="let request of group.requests">
                    {{ request }}
                    <button (click)="approveRequest(group.name, request)">Approve</button>
                    <button (click)="denyRequest(group.name, request)">Deny</button>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <!-- Display for Chat User -->
      <div *ngIf="userRole === 'chatUser'">
        <h3>Available Groups:</h3>
        <ul *ngIf="groups.length > 0">
          <li *ngFor="let group of groups">
            {{ group.name }}
            <ul *ngIf="group.channels.length > 0">
              <li *ngFor="let channel of group.channels">
                {{ channel.name }}
                <button (click)="joinChannel(group.name, channel.name)" *ngIf="!channel.members.includes(chatUser?.username || '')">Join Channel</button>
                <button (click)="leaveChannel(group.name, channel.name)" *ngIf="channel.members.includes(chatUser?.username || '')">Leave Channel</button>
              </li>
            </ul>
          </li>
        </ul>
        <p *ngIf="groups.length === 0">No groups available to view.</p>
      </div>
    </section>

    <!-- User Management Section -->
<section *ngIf="isAuthenticated && currentSection === 'user-management'" class="user-management-section">
  <h2>User Management</h2>
  <div *ngIf="userRole === 'superAdmin'">
    <button (click)="createUser()">Create User</button>
    <button (click)="deleteUser()">Delete User</button>
    <button (click)="promoteUser()">Promote User</button>
    <button (click)="demoteUser()">Demote User</button>
    <ul>
      <li *ngFor="let user of users">{{ user.username }} ({{ user.role }})</li>
    </ul>
  </div>
</section>

    <!-- Video Chat Section -->
    <section *ngIf="isAuthenticated && currentSection === 'video-chat'" class="video-chat-section">
      <h2>Video Chat</h2>
      <app-video-chat></app-video-chat>
    </section>
  </main>


  <!-- Footer Section -->
  <footer class="app-footer" *ngIf="isAuthenticated">
  </footer>
</div>
